---
title: "V4.1 Race and Language Model"
date: "02/23/2022"
output:
  pdf_document: default
  word_document: default
  html_document: default
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r}
library(readxl)

library(tidyverse)
library(tidycensus)
library(dplyr)
library(ggplot2)
library(knitr)
library(qqplotr)

library(lattice)
library(survival)
library(Formula)
library(Hmisc)


library(Metrics)
library(lmtest)
library(fBasics)
library(segmented)

library(corrplot)
#library(raster)
#library(rgdal)
#library(classInt)
library(RColorBrewer)

library(oaxaca)
library(devtools)

library(viridis)#viridisLite provides the base functions for generating the color maps in base R 
```


## 1. import dataset

```{r}

Dataset_V3_withSex <- read_excel("E:/360MoveData/Users/GRACE/Desktop/Health Equity/4th submission/Dataset_V3_WithSexUninsuredPercent.xlsx", 
                         
    col_types = c("numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric","numeric","numeric"))

Dataset_V3_withSex
#Rows: 210 Columns: 28
```
```{r}
glimpse(Dataset_V3_withSex)
#Rows: 210 Columns: 28
```


## 2. Correlation Analysis 


```{r}

cordata<-Dataset_V3_withSex%>%
  dplyr::select(c(Race_White_alone_Uninsured_Percent,Race_Hispanic_or_Latino_Uninsured_Percent,Persons_who_speak_English_less_than_well_Percent))
cordata

#210*3

```
```{r}
minority.rcorr = rcorr(as.matrix(cordata))
minority.rcorr
```




```{r}
png("file.png")
M <- cor(cordata)
corrplot(M, type = "upper", tl.pos = "td",
         method = "circle", tl.cex = 0.5, tl.col = 'black',
         order = "hclust", col=brewer.pal(n=8, name="RdYlBu"),diag = FALSE)

dev.off()

```


## 3. Regression Analysis


### 3.1 Linear model for the whole dataset
```{r}

Minority__lmModel <- lm(Total_Uninsured_Percent~Race_Hispanic_or_Latino_Uninsured_Percent+Persons_who_speak_English_less_than_well_Percent+Race_White_alone_Uninsured_Percent, data=Dataset_V3_withSex)
summary(Minority__lmModel)
```
1. F-statistic: p-value: < 2.2e-16. The regression model fits the data better than the model with no independent variables.


2. Adjusted R-squared:  0.8856    Goodness-of-fit measure

3. Coefficients p-value. Coefficients are independent variables. The coefficients has effects on y.

Race_Hispanic_or_Latino_Uninsured_Percent          <2e-16 ***
Persons_who_speak_English_less_than_well_Percent   <2e-16 ***
Race_White_alone_Uninsured_Percent                 <2e-16 *** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1  

4. I will do residuals analysis later.



### 3.2 Linear model for the rank80 0 group
```{r}
group0_data<-Dataset_V3_withSex%>%
  dplyr::filter(rank80 ==0) 
group0_data

```

```{r}
Minority0__lmModel <- lm(Total_Uninsured_Percent~Race_Hispanic_or_Latino_Uninsured_Percent+Persons_who_speak_English_less_than_well_Percent+Race_White_alone_Uninsured_Percent, data=group0_data)
summary(Minority0__lmModel)


```
1. F-statistic: p-value: < 2.2e-16. The regression model fits the data better than the model with no independent variables.


2. Adjusted R-squared:  0.8225  Goodness-of-fit measure

3. Coefficients p-value. Coefficients are independent variables. The coefficients has effects on y.


Race_Hispanic_or_Latino_Uninsured_Percent         < 2e-16 ***
Persons_who_speak_English_less_than_well_Percent 5.07e-13 ***
Race_White_alone_Uninsured_Percent                < 2e-16 ***

4. I will do residuals analysis later.

### 3.3 Linear model for the rank80 1 group

```{r}

group1_data<-Dataset_V3_withSex%>%
  dplyr::filter(rank80 ==1) 
group1_data

```
```{r}

Minority1__lmModel <- lm(Total_Uninsured_Percent~Race_Hispanic_or_Latino_Uninsured_Percent+Persons_who_speak_English_less_than_well_Percent+Race_White_alone_Uninsured_Percent, data=group1_data)
summary(Minority1__lmModel)

```
1. F-statistic: p-value: < 4.483e-10. The regression model fits the data better than the model with no independent variables.


2. Adjusted R-squared:  0.6779   

3. Coefficients p-value. Coefficients are independent variables. The coefficients has effects on y.
Race_Hispanic_or_Latino_Uninsured_Percent        2.90e-05 ***
Persons_who_speak_English_less_than_well_Percent 5.00e-06 ***
Race_White_alone_Uninsured_Percent               2.37e-06 ***


## 4. Oaxaca decomposition 
```{r}
oaxaca_Minority_results <- oaxaca(formula = Total_Uninsured_Percent ~  Persons_who_speak_English_less_than_well_Percent + Race_Hispanic_or_Latino_Uninsured_Percent+Race_White_alone_Uninsured_Percent|rank80, data = Dataset_V3_withSex)
names(summary(oaxaca_Minority_results))
summary(oaxaca_Minority_results)

```


```{r}
plot(oaxaca_Minority_results, components = c("endowments","coefficients")) +
  labs(
    title = "Minority Status Oaxaca Decomposition "
    )
```














